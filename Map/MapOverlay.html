<!DOCTYPE html>
<html>
  <head>
    <title>WIPLS</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmexPtEq3x47gN0jvXbcsAv5GlZGSD02Q&libraries=geometry"></script>
    <script>
        
function initialize() {
    var json = $.getJSON("data.json").done(function () {showMap(json);});
}
        
function showMap(json) {
    //console.log(json);
    var data = JSON.parse(json.responseText);
    //console.log(data);
    
    function DatasetTextbox(controlDiv, map) {
        controlDiv.style.padding = '5px';
        var controlUI = document.createElement('div');
        controlUI.style.backgroundColor = '#fff';
        controlUI.style.border = '2px solid #fff';
        controlUI.style.borderRadius = '3px';
        controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
        controlUI.style.cursor = 'pointer';
        controlUI.style.marginBottom = '5px';
        controlUI.title = 'Dataset';
        controlDiv.appendChild(controlUI);
        
        var controlText = document.createElement('div');
        controlText.style.color = 'rgb(25,25,25)';
        controlText.style.fontFamily = 'Roboto,Arial,sans-serif';
        controlText.style.fontSize = '16px';
        controlText.style.lineHeight = '18px';
        controlText.style.paddingLeft = '5px';
        controlText.style.paddingRight = '5px';
        controlText.innerHTML = '<center><strong>WIPLS Locator Map<br /> <font style="font-size:80%">Dataset:</strong> ' + data.dataset + '</center>'/* +
            '<div align="right"><font style="font-size:50%"><em>Click for details.</em></font></div>'*/;
        controlUI.appendChild(controlText);
        
        google.maps.event.addDomListener(controlUI, 'click', function() {
            window.open("data.json");
        });
    }
    
    beaconCoords = new google.maps.LatLng(data.beaconCoords.lat, data.beaconCoords.long);
    var beaconGuessCoords = new google.maps.LatLng(data.beaconGuessCoords.lat, data.beaconGuessCoords.long);
    var beaconPolygonCoords = [
        new google.maps.LatLng(data.guessVector[0].lat, data.guessVector[0].long),
        new google.maps.LatLng(data.guessVector[1].lat, data.guessVector[1].long),
        new google.maps.LatLng(data.guessVector[2].lat, data.guessVector[2].long)
    ];
    var antenna1Coords = new google.maps.LatLng(data.antenna1Coords.lat, data.antenna1Coords.long);
    var antenna2Coords = new google.maps.LatLng(data.antenna2Coords.lat, data.antenna2Coords.long);
    var antenna3Coords = new google.maps.LatLng(data.antenna3Coords.lat, data.antenna3Coords.long);
    
    var mapOptions = {
        center: beaconCoords,
        zoom: 18
    };

    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    
    var datasetTextboxDiv = document.createElement('div');
    var datasetTextbox = new DatasetTextbox(datasetTextboxDiv, map);
    
    datasetTextbox.index = 1;
    map.controls[google.maps.ControlPosition.TOP_CENTER].push(datasetTextboxDiv);
        
    var distanceoff = google.maps.geometry.spherical.computeDistanceBetween(beaconCoords,beaconGuessCoords);

    var beacon = new google.maps.Marker({
        position: beaconCoords,
        map: map,
        title: 'True beacon position',
        icon: 'http://i.imgur.com/AOm4N8n.png'
    });
    
    var beaconInfo = new google.maps.InfoWindow({
        content: "<font style=\"font-weight: bold\">True beacon position</font><br/>"+
        beaconCoords.lat().toFixed(4) + ", " + beaconCoords.lng().toFixed(4)
    });
    
    var beaconGuess = new google.maps.Marker({
        position: beaconGuessCoords,
        map: map,
        title: 'Guessed beacon position',
        icon: 'http://i.imgur.com/9wox1aO.png'
    });
    
    var beaconGuessInfo = new google.maps.InfoWindow({
        content: "<font style=\"font-weight: bold\">Guessed beacon position</font><br/>" +
        beaconGuessCoords.lat().toFixed(4) + ", " + beaconGuessCoords.lng().toFixed(4) +
        "<br/> Error: " + distanceoff.toFixed(4) + "m"
    });
    
    var beaconPolygon = new google.maps.Polygon({
       paths: beaconPolygonCoords,
        strokeColor: '#00FF00',
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: '#00FF00',
        fillOpacity: 0.35
    });
    
    beaconPolygon.setMap(map);
    
    var beaconPolygonInfo = new google.maps.InfoWindow({
       content: "<font style=\"font-weight: bold\">Approximate beacon area</font></br>"
    });
    
    var antenna1 = new google.maps.Marker({
        position: antenna1Coords,
        map: map,
        title: 'Tracker one position',
        icon: 'http://i.imgur.com/kN8u5cm.png'
    });
    
    var antenna1Info = new google.maps.InfoWindow({
        content: "<font style=\"font-weight: bold\">Tracker one position</font><br/>"+
        antenna1Coords.lat().toFixed(4) + ", " + antenna1Coords.lng().toFixed(4)
    });
    
    var antenna2 = new google.maps.Marker({
        position: antenna2Coords,
        map: map,
        title: 'Tracker two position',
        icon: 'http://i.imgur.com/kN8u5cm.png'
    });
    
    var antenna2Info = new google.maps.InfoWindow({
        content: "<font style=\"font-weight: bold\">Tracker two position</font><br/>"+
        antenna2Coords.lat().toFixed(4) + ", " + antenna2Coords.lng().toFixed(4)
    });
    
    var antenna3 = new google.maps.Marker({
        position: antenna3Coords,
        map: map,
        title: 'Tracker three position',
        icon: 'http://i.imgur.com/kN8u5cm.png'
    });
    
    var antenna3Info = new google.maps.InfoWindow({
        content: "<font style=\"font-weight: bold\">Tracker three position</font><br/>"+
        antenna3Coords.lat().toFixed(4) + ", " + antenna3Coords.lng().toFixed(4)
    });
    
    google.maps.event.addListener(beacon, 'click', function() {
        beaconInfo.open(map, beacon); 
    });
    google.maps.event.addListener(beaconGuess, 'click', function() {
        beaconGuessInfo.open(map, beaconGuess); 
    });
    google.maps.event.addListener(beaconPolygon, 'click', function() {
        beaconPolygonInfo.open(map, beaconGuess);
    });
    google.maps.event.addListener(antenna1, 'click', function() {
        antenna1Info.open(map, antenna1); 
    });
    google.maps.event.addListener(antenna2, 'click', function() {
        antenna2Info.open(map, antenna2); 
    });
    google.maps.event.addListener(antenna3, 'click', function() {
        antenna3Info.open(map, antenna3); 
    });
    
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>